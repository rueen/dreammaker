(function(){"use strict";var t={5868:function(t,e,n){var a=n(5130),i=n(6768);function s(t,e){const n=(0,i.g2)("router-view");return(0,i.uX)(),(0,i.Wv)(n)}var o=n(1241);const c={},d=(0,o.A)(c,[["render",s]]);var l=d,r=n(1387);const m={class:"about"};function h(t,e,n,a,s,o){const c=(0,i.g2)("Template1"),d=(0,i.g2)("Template2"),l=(0,i.g2)("Template3"),r=(0,i.g2)("Template4");return(0,i.uX)(),(0,i.CE)("div",m,["template1"===s.activeItem.template?((0,i.uX)(),(0,i.Wv)(c,{key:0,data:s.activeItem,onOnEnd:e[0]||(e[0]=t=>o.onEnd())},null,8,["data"])):(0,i.Q3)("",!0),"template2"===s.activeItem.template?((0,i.uX)(),(0,i.Wv)(d,{key:1,data:s.activeItem,onOnEnd:e[1]||(e[1]=t=>o.onEnd())},null,8,["data"])):(0,i.Q3)("",!0),"template3"===s.activeItem.template?((0,i.uX)(),(0,i.Wv)(l,{key:2,data:s.activeItem,onOnEnd:e[2]||(e[2]=t=>o.onEnd())},null,8,["data"])):(0,i.Q3)("",!0),"template4"===s.activeItem.template?((0,i.uX)(),(0,i.Wv)(r,{key:3,data:s.activeItem,onReStart:e[3]||(e[3]=t=>o.reStart())},null,8,["data"])):(0,i.Q3)("",!0)])}var u=n(4232);const p=t=>((0,i.Qi)("data-v-64f8d051"),t=t(),(0,i.jt)(),t),v={class:"left"},f={class:"sexList"},g={class:"sexItemContent"},k=p((()=>(0,i.Lk)("div",{class:"iconBox"},[(0,i.Lk)("span",{class:"iconfont icon-male sexIcon"}),(0,i.Lk)("span",{class:"sexTag"},"male")],-1))),w={class:"sexText"},b={class:"sexItemContent"},y=p((()=>(0,i.Lk)("div",{class:"iconBox"},[(0,i.Lk)("span",{class:"iconfont icon-female sexIcon"}),(0,i.Lk)("span",{class:"sexTag"},"female")],-1))),I={class:"sexText"},x={class:"right"},C=p((()=>(0,i.Lk)("span",{class:"iconfont icon-refresh",style:{"font-size":"1.2rem","margin-right":"10px"}},null,-1))),T=p((()=>(0,i.Lk)("span",null,"重新拍",-1)));function E(t,e,n,a,s,o){const c=(0,i.g2)("FaceTracking"),d=(0,i.g2)("CustomButton");return(0,i.uX)(),(0,i.CE)("div",{id:"template1",class:"container",style:(0,u.Tr)({background:`url(${n.data.bgUrl}) no-repeat 0 0`})},[(0,i.Lk)("div",v,[(0,i.Lk)("div",f,[(0,i.Lk)("div",{class:(0,u.C4)(["sexItem sexMale","male"===s.activeSex?"activeSex":""]),onClick:e[0]||(e[0]=t=>o.selectSex("male"))},[(0,i.Lk)("div",g,[k,(0,i.Lk)("div",w,(0,u.v_)(n.data.maleText),1)])],2),(0,i.Lk)("div",{class:(0,u.C4)(["sexItem","female"===s.activeSex?"activeSex":""]),onClick:e[1]||(e[1]=t=>o.selectSex("female"))},[(0,i.Lk)("div",b,[y,(0,i.Lk)("div",I,(0,u.v_)(n.data.femaleText),1)])],2)])]),(0,i.Lk)("div",x,[(0,i.bF)(c,{ref:"refFaceTracking",onGetPhoto:e[2]||(e[2]=t=>o.getPhoto(t))},null,512),s.photo?((0,i.uX)(),(0,i.CE)("div",{key:0,class:"btnBox",style:(0,u.Tr)({width:`${s.cameraWidth}px`})},[(0,i.bF)(d,{theme:"white",onClick:e[3]||(e[3]=t=>o.reTrack()),style:{width:"10rem"}},{default:(0,i.k6)((()=>[C,T])),_:1}),(0,i.bF)(d,{theme:"blue",style:{width:"10rem"},onClick:o.nextStep},{default:(0,i.k6)((()=>[(0,i.eW)("下一步")])),_:1},8,["onClick"])],4)):(0,i.Q3)("",!0)])],4)}const L=["width","height"],_=["width","height"],S={class:"mask"},W={key:0,class:"tips"},B={key:0,class:"countdown"};function O(t,e,n,a,s,o){return(0,i.uX)(),(0,i.CE)("div",{class:"faceCamera",style:(0,u.Tr)({width:`${s.width}px`,height:`${s.width}px`})},[(0,i.Lk)("video",{ref:"refVideo",id:"video",width:s.width,height:s.width,autoplay:""},null,8,L),(0,i.Lk)("canvas",{ref:"refCanvas",id:"canvas",width:s.width,height:s.width},null,8,_),(0,i.Lk)("div",S,[s.tipsContent?((0,i.uX)(),(0,i.CE)("div",W,(0,u.v_)(s.tipsContent),1)):(0,i.Q3)("",!0)]),s.countdown>0?((0,i.uX)(),(0,i.CE)("div",B,(0,u.v_)(s.countdown),1)):(0,i.Q3)("",!0)],4)}n(362),n(3688);const $=window.tracking;var j={name:"FaceTracking",components:{},data(){return{width:parseInt(window.innerWidth/100*25),videoWidth:parseInt(window.innerWidth/100*25),videoHeight:parseInt(window.innerWidth/100*25),countdown:0,countdownTimer:null,tipsContent:null,context:null,video:null,canvas:null,tracker:null,imgUrl:null}},mounted(){document.addEventListener("visibilitychange",this.watchVisibility),this.playVideo()},beforeUnmount(){document.removeEventListener("visibilitychange",this.watchVisibility),this.pauseVideo()},methods:{watchVisibility(){"hidden"===document.visibilityState?this.pauseVideo():this.reTrack()},takePhoto(){this.$refs.refVideo&&(this.context.drawImage(this.$refs.refVideo,Math.abs((this.videoWidth-this.videoHeight)/2),0,this.videoHeight,this.videoHeight,0,0,this.width,this.width),this.imgUrl=this.saveAsPNG(this.$refs.refCanvas),clearInterval(this.countdownTimer),this.pauseVideo(),this.$emit("getPhoto",{photo:this.imgUrl,cameraWidth:this.width}))},saveAsPNG(t){return t.toDataURL("image/png",.3)},reTrack(){this.countdown=0,this.countdownTimer=null,this.tipsContent=null,this.context=null,this.video=null,this.canvas=null,this.tracker=null,this.imgUrl=null,this.playVideo()},playVideo(){this.video=document.getElementById("video"),navigator.mediaDevices.getUserMedia({video:{}}).then((t=>{this.video.srcObject=t;let e=0;const n=setInterval((()=>{this.video.videoWidth?(clearInterval(n),this.videoWidth=this.video.videoWidth,this.videoHeight=this.video.videoHeight):e>50?(clearInterval(n),console.log("video加载失败")):e+=1}),100)})),this.canvas=document.getElementById("canvas"),this.context=this.canvas.getContext("2d"),this.tracker=new $.ObjectTracker("face"),this.tracker.setInitialScale(4),this.tracker.setStepSize(2),this.tracker.setEdgesDensity(.1);try{$.track("#video",this.tracker,{camera:!0})}catch(t){console.log("访问用户媒体失败，请重试")}this.tracker.on("track",(t=>{this.context.clearRect(0,0,this.canvas.width,this.canvas.height),t.data&&t.data.length?(this.tipsContent="检测成功，正在拍照，请保持不动",this.flag||(this.countdown=2,this.flag=!0,this.countdownTimer=setInterval((()=>{this.countdown>0?this.countdown--:(this.takePhoto(),clearInterval(this.countdownTimer))}),1e3))):(this.tipsContent="未检测到人脸",clearInterval(this.countdownTimer),this.countdown=0,this.flag=!1),t.data.forEach((t=>{this.context.strokeStyle="#a64ceb",this.context.strokeRect(t.x,t.y,t.width,t.height)}))}))},pauseVideo(){this.countdownTimer&&clearInterval(this.countdownTimer);var t=document.getElementById("video"),e=t.srcObject,n=e?e.getTracks():[];n.forEach((function(t){t.stop()})),t.srcObject=null,t.pause()}}};const X=(0,o.A)(j,[["render",O],["__scopeId","data-v-205b753c"]]);var V=X;function U(t,e,n,a,s,o){return(0,i.uX)(),(0,i.CE)("div",{class:(0,u.C4)(["buttonContainer",n.theme]),style:(0,u.Tr)(n.style)},[(0,i.RG)(t.$slots,"default",{},void 0,!0)],6)}n(362),n(3688);var Q={name:"CustomButton",components:{},props:["theme","style"],data(){return{}},mounted(){},methods:{}};const A=(0,o.A)(Q,[["render",U],["__scopeId","data-v-988ca224"]]);var F=A,P={name:"Template1View",props:["data"],components:{FaceTracking:V,CustomButton:F},data(){return{activeSex:"male",photo:null,cameraWidth:null}},mounted(){document.getElementById("template1").classList.add("fadeIn")},beforeUnmount(){document.getElementById("template1").classList.remove("fadeIn"),document.getElementById("template1").classList.add("fadeOut")},methods:{selectSex(t){this.activeSex=t},reTrack(){this.$refs.refFaceTracking&&(this.$refs.refFaceTracking.reTrack(),this.photo=null)},getPhoto(t){const{photo:e,cameraWidth:n}=t;this.photo=e,this.cameraWidth=n},nextStep(){this.$emit("onEnd")}}};const D=(0,o.A)(P,[["render",E],["__scopeId","data-v-64f8d051"]]);var N=D;const R=t=>((0,i.Qi)("data-v-13b74027"),t=t(),(0,i.jt)(),t),z=R((()=>(0,i.Lk)("div",{class:"wrap"},[(0,i.Lk)("div",{id:"title"}),(0,i.Lk)("div",{id:"content"})],-1)));function H(t,e,n,a,s,o){const c=(0,i.g2)("CustomButton");return(0,i.uX)(),(0,i.CE)("div",{id:"template2",class:"container",style:(0,u.Tr)({background:`url(${n.data.bgUrl}) no-repeat 0 0`})},[z,s.isShowNext?((0,i.uX)(),(0,i.Wv)(c,{key:0,theme:"blue",style:{width:"10rem"},onClick:o.nextStep},{default:(0,i.k6)((()=>[(0,i.eW)("下一步")])),_:1},8,["onClick"])):(0,i.Q3)("",!0)],4)}var G=n(7891),M={name:"Template2View",props:["data"],components:{CustomButton:F},data(){return{isShowNext:!1}},mounted(){document.getElementById("template2").classList.add("fadeIn"),new G.A("#title",{strings:[`${this.data.title}`],typeSpeed:100,startDelay:300,loop:!1,onComplete:()=>{new G.A("#content",{strings:[`${this.data.content}`],typeSpeed:100,startDelay:300,loop:!1,onComplete:()=>{this.isShowNext=!0}})}})},methods:{nextStep(){this.$emit("onEnd")}}};const J=(0,o.A)(M,[["render",H],["__scopeId","data-v-13b74027"]]);var K=J;const q=t=>((0,i.Qi)("data-v-2de00480"),t=t(),(0,i.jt)(),t),Y={class:"options"},Z=["id","onClick"],tt=["src"],et={class:"name"},nt={key:0,class:"selectedBox"},at=q((()=>(0,i.Lk)("div",{class:"title"},"你将选择成为一名",-1))),it={class:"selected"};function st(t,e,n,a,s,o){const c=(0,i.g2)("CustomButton");return(0,i.uX)(),(0,i.CE)("div",{id:"template3",class:"container",style:(0,u.Tr)({background:`url(${n.data.bgUrl}) no-repeat 0 0`})},[(0,i.Lk)("div",Y,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.data.options,((t,e)=>((0,i.uX)(),(0,i.CE)("div",{class:"optionItem hide",id:`option_${t.id}`,key:e,style:(0,u.Tr)({width:`${s.optionItemWidth}px`,height:1.4*s.optionItemWidth+"px"}),onClick:e=>o.handleSelect(t)},[(0,i.Lk)("img",{class:"image",src:t.image,alt:""},null,8,tt),(0,i.Lk)("div",et,(0,u.v_)(t.name),1)],12,Z)))),128))]),s.selectedOption?((0,i.uX)(),(0,i.CE)("div",nt,[at,(0,i.Lk)("div",it,(0,u.v_)(s.selectedOption.name),1)])):(0,i.Q3)("",!0),s.selectedOption?((0,i.uX)(),(0,i.Wv)(c,{key:1,theme:"blue",style:{width:"10rem"},onClick:o.nextStep},{default:(0,i.k6)((()=>[(0,i.eW)("下一步")])),_:1},8,["onClick"])):(0,i.Q3)("",!0)],4)}var ot={name:"Template3View",props:["data"],components:{CustomButton:F},data(){return{optionItemWidth:null,selectedOption:null}},mounted(){document.getElementById("template3").classList.add("fadeIn"),this.optionItemWidth=parseInt(.6*window.innerWidth/this.data.options.length),this.data.options.forEach(((t,e)=>{const n=document.getElementById(`option_${t.id}`);n&&setTimeout((()=>{n.classList.remove("hide"),n.classList.add("fadeInDownBig")}),100*e)}))},methods:{handleSelect(t){this.selectedOption={...t};const e=document.getElementById(`option_${t.id}`);e&&(this.data.options.forEach((t=>{const e=document.getElementById(`option_${t.id}`);e&&(e.classList.remove("scaleUp"),e.classList.remove("fadeInDownBig"))})),e.classList.add("scaleUp"))},nextStep(){this.$emit("onEnd")}}};const ct=(0,o.A)(ot,[["render",st],["__scopeId","data-v-2de00480"]]);var dt=ct;const lt=t=>((0,i.Qi)("data-v-8993be7e"),t=t(),(0,i.jt)(),t),rt=lt((()=>(0,i.Lk)("span",{class:"iconfont icon-refresh",style:{"font-size":"1.2rem","margin-right":"10px"}},null,-1))),mt=lt((()=>(0,i.Lk)("span",null,"重新体验",-1)));function ht(t,e,n,a,s,o){const c=(0,i.g2)("CustomButton");return(0,i.uX)(),(0,i.CE)("div",{id:"template4",class:"container",style:(0,u.Tr)({background:`url(${n.data.bgUrl}) no-repeat 0 0`})},[(0,i.bF)(c,{theme:"blue",onClick:o.reStart},{default:(0,i.k6)((()=>[rt,mt])),_:1},8,["onClick"])],4)}var ut={name:"Template4View",props:["data"],components:{CustomButton:F},data(){return{optionItemWidth:null,selectedOption:null}},mounted(){document.getElementById("template4").classList.add("fadeIn")},methods:{reStart(){this.$emit("reStart")}}};const pt=(0,o.A)(ut,[["render",ht],["__scopeId","data-v-8993be7e"]]);var vt=pt;const ft={name:"场景名称",desc:"场景描述",launchVideo:"https://us-stock5.xpccdn.com/9db72648-b9e1-47cd-86bd-b92ff4ff3780.mp4",launchAudio:"",status:1,list:[{id:1,template:"template1",title:"标题",maleText:"我是一位超级大帅哥",femaleText:"我是一位美女",audio:"https://pic.ibaotu.com/mp3Watermark_v3/17/88/84/31b5fd17a01953e7506ad3b570032415.mp3",bgUrl:"https://gw.alicdn.com/imgextra/i2/O1CN01R8zDb51craBhnk9pQ_!!6000000003654-0-tps-7680-2400.jpg",nextId:2},{id:2,template:"template2",title:"我们的十年",content:"在70年代的十堰，你作为造车厂工人的身影烙印在了城市崛起的历程中。从组织劳动竞赛提升生产效率，担任车间主任后专注技能培训，你以实际行动点燃了工人们的热情，铸就了团队的坚实力量。预测着未来，你将引领十堰汽车工业迈向辉煌。你的名字将成为这座城市繁荣美丽的注脚。",audio:"",video:"",bgUrl:"https://seatent.com/img/fxpage/cloud-bg.jpg",nextId:3},{id:3,template:"template3",title:"标题",bgUrl:"",audio:"",optionNum:3,optionType:1,nextId:4,options:[{id:1,name:"成为工人",image:"https://statics.seatent.com/statics/99cea281725792cfefc2737e7f5ecb3d/attachment/upload/image/20230914/5d6b2b02fbd74efc97a85c580e9f2749_small.jpg"},{id:2,name:"成为医生",image:"https://statics.seatent.com/statics/99cea281725792cfefc2737e7f5ecb3d/attachment/upload/image/20230914/c0e1cd7b3b3f44508203ab47365183f7_small.jpg"},{id:3,name:"成为汽车手",image:"https://statics.seatent.com/statics/99cea281725792cfefc2737e7f5ecb3d/attachment/upload/image/20220920/436880545f48423587c7a042a8986eeb_small.jpg"},{id:4,name:"成为汽车手",image:"https://statics.seatent.com/statics/99cea281725792cfefc2737e7f5ecb3d/attachment/upload/image/20220920/436880545f48423587c7a042a8986eeb_small.jpg"},{id:5,name:"成为汽车手",image:"https://statics.seatent.com/statics/99cea281725792cfefc2737e7f5ecb3d/attachment/upload/image/20220920/436880545f48423587c7a042a8986eeb_small.jpg"}]},{id:4,template:"template4",title:"标题",bgUrl:"",messageType:1,prompt:""}]};var gt=ft,kt={name:"JourneyView",components:{Template1:N,Template2:K,Template3:dt,Template4:vt},data(){return{list:[],activeItem:{}}},mounted(){const t=(0,r.rd)(),e=t.currentRoute.value,{id:n}=e.params;console.log(n,gt),this.list=gt.list||[],this.activeItem=this.list[0]},methods:{onEnd(){if(!this.activeItem.nextId)return;const t=this.list.find((t=>t.id===this.activeItem.nextId));this.activeItem=t},reStart(){this.activeItem=this.list[0]}}};const wt=(0,o.A)(kt,[["render",h]]);var bt=wt;const yt=[{path:"/journey/:id",name:"journey",component:bt}],It=(0,r.aE)({history:(0,r.Bt)(),routes:yt});var xt=It;const Ct=(t,e)=>{let n;return function(){const a=this,i=arguments;clearTimeout(n),n=setTimeout((()=>{t.apply(a,i)}),e)}};(0,a.Ef)(l).use(xt).mount("#app");const Tt=()=>{const t=window.innerWidth;document.documentElement.style.fontSize=`${parseInt(t/100)}px`};window.addEventListener("resize",Ct((function(){Tt()}),1e3)),Tt()}},e={};function n(a){var i=e[a];if(void 0!==i)return i.exports;var s=e[a]={exports:{}};return t[a].call(s.exports,s,s.exports,n),s.exports}n.m=t,function(){var t=[];n.O=function(e,a,i,s){if(!a){var o=1/0;for(r=0;r<t.length;r++){a=t[r][0],i=t[r][1],s=t[r][2];for(var c=!0,d=0;d<a.length;d++)(!1&s||o>=s)&&Object.keys(n.O).every((function(t){return n.O[t](a[d])}))?a.splice(d--,1):(c=!1,s<o&&(o=s));if(c){t.splice(r--,1);var l=i();void 0!==l&&(e=l)}}return e}s=s||0;for(var r=t.length;r>0&&t[r-1][2]>s;r--)t[r]=t[r-1];t[r]=[a,i,s]}}(),function(){n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,{a:e}),e}}(),function(){n.d=function(t,e){for(var a in e)n.o(e,a)&&!n.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={524:0};n.O.j=function(e){return 0===t[e]};var e=function(e,a){var i,s,o=a[0],c=a[1],d=a[2],l=0;if(o.some((function(e){return 0!==t[e]}))){for(i in c)n.o(c,i)&&(n.m[i]=c[i]);if(d)var r=d(n)}for(e&&e(a);l<o.length;l++)s=o[l],n.o(t,s)&&t[s]&&t[s][0](),t[s]=0;return n.O(r)},a=self["webpackChunkdreammaker"]=self["webpackChunkdreammaker"]||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))}();var a=n.O(void 0,[504],(function(){return n(5868)}));a=n.O(a)})();
//# sourceMappingURL=app.9da506c0.js.map